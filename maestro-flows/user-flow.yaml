appId: ${APP_ID}
---
# Reset app state for clean test
- clearState

# Launch app
- launchApp

# Wait for welcome screen
- assertVisible: "Welcome"

# Click Connect Wallet
- tapOn: "Connect Wallet"

# Wait for import screen
- assertVisible: "Import Wallet"

# Clear and enter derivation path for USER enclave
- tapOn:
    id: "derivationPath"
- eraseText
- tapOn:
    id: "derivationPath"
- eraseText
- inputText: "m/44'/60'/0'/0/4"
- hideKeyboard

# Generate wallet
- tapOn:
    text: "Import Wallet"
    index: 1

# Wait for success dialog
- assertVisible: "Wallet Imported"

# Dismiss dialog
- tapOn: "OK"

# Wait for credentials to load
- waitForAnimationToEnd

# Check if credentials exist
- runFlow:
    when:
      visible: "No credentials found"
    commands:
      - stopApp
      - assertVisible: "This test wallet has no credentials"

# Tap on first credential card
- tapOn:
    id: "CredentialCard"
    index: 0

# Wait for detail screen
- assertVisible: "This credential is encrypted"

# Tap to decrypt
- tapOn: "Decrypt Content"

# Wait for USER enclave dialog
- assertVisible: "Generate Encryption Key"

# Select expiration
- tapOn: "1 Week"

# Enter password for USER enclave
- tapOn: "Password"
- inputText: ${PASSWORD}
- hideKeyboard
- scroll
- waitForAnimationToEnd

# Generate key
- tapOn: "Generate Key"

# Wait for decryption
- waitForAnimationToEnd

# Verify content is decrypted
- assertNotVisible: "This credential is encrypted"

# Verify decrypted content contains @context
- assertVisible: "@context"
